function fr(t){let e=t[0],r=t[1],s=t[2];return Math.sqrt(e*e+r*r+s*s)}function Ft(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function gs(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t}function ur(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function cr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ps(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function vs(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function xt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function bs(t,e){let r=e[0]-t[0],s=e[1]-t[1],h=e[2]-t[2];return Math.sqrt(r*r+s*s+h*h)}function ms(t,e){let r=e[0]-t[0],s=e[1]-t[1],h=e[2]-t[2];return r*r+s*s+h*h}function or(t){let e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}function ys(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function ws(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Tt(t,e){let r=e[0],s=e[1],h=e[2],l=r*r+s*s+h*h;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t}function Dr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xs(t,e,r){let s=e[0],h=e[1],l=e[2],u=r[0],c=r[1],p=r[2];return t[0]=h*p-l*c,t[1]=l*u-s*p,t[2]=s*c-h*u,t}function Es(t,e,r,s){let h=e[0],l=e[1],u=e[2];return t[0]=h+s*(r[0]-h),t[1]=l+s*(r[1]-l),t[2]=u+s*(r[2]-u),t}function Ms(t,e,r){let s=e[0],h=e[1],l=e[2],u=r[3]*s+r[7]*h+r[11]*l+r[15];return u=u||1,t[0]=(r[0]*s+r[4]*h+r[8]*l+r[12])/u,t[1]=(r[1]*s+r[5]*h+r[9]*l+r[13])/u,t[2]=(r[2]*s+r[6]*h+r[10]*l+r[14])/u,t}function _s(t,e,r){let s=e[0],h=e[1],l=e[2],u=r[0],c=r[1],p=r[2],w=r[3],E=c*l-p*h,M=p*s-u*l,v=u*h-c*s,y=c*v-p*M,T=p*E-u*v,P=u*M-c*E,S=w*2;return E*=S,M*=S,v*=S,y*=2,T*=2,P*=2,t[0]=s+E+y,t[1]=h+M+T,t[2]=l+v+P,t}const As=function(){const t=[0,0,0],e=[0,0,0];return function(r,s){Ft(t,r),Ft(e,s),Tt(t,t),Tt(e,e);let h=Dr(t,e);return h>1?0:h<-1?Math.PI:Math.acos(h)}}();function Fs(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}class re extends Array{constructor(e=0,r=e,s=e){return super(e,r,s),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,r=e,s=e){return e.length?this.copy(e):(gs(this,e,r,s),this)}copy(e){return Ft(this,e),this}add(e,r){return r?ur(this,e,r):ur(this,this,e),this}sub(e,r){return r?cr(this,e,r):cr(this,this,e),this}multiply(e){return e.length?ps(this,this,e):xt(this,this,e),this}divide(e){return e.length?vs(this,this,e):xt(this,this,1/e),this}inverse(e=this){return ws(this,e),this}len(){return fr(this)}distance(e){return e?bs(this,e):fr(this)}squaredLen(){return or(this)}squaredDistance(e){return e?ms(this,e):or(this)}negate(e=this){return ys(this,e),this}cross(e,r){return xs(this,e,r),this}scale(e){return xt(this,this,e),this}normalize(){return Tt(this,this),this}dot(e){return Dr(this,e)}equals(e){return Fs(this,e)}applyMatrix4(e){return Ms(this,this,e),this}applyQuaternion(e){return _s(this,this,e),this}angle(e){return As(this,e)}lerp(e,r){return Es(this,this,e,r),this}clone(){return new re(this[0],this[1],this[2])}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this[2]=e[r+2],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e}transformDirection(e){const r=this[0],s=this[1],h=this[2];return this[0]=e[0]*r+e[4]*s+e[8]*h,this[1]=e[1]*r+e[5]*s+e[9]*h,this[2]=e[2]*r+e[6]*s+e[10]*h,this.normalize()}}const dr=new re;let Ts=1,Rs=1,gr=!1;class Lr{constructor(e,r={}){this.gl=e,this.attributes=r,this.id=Ts++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let s in r)this.addAttribute(s,r[s])}addAttribute(e,r){if(this.attributes[e]=r,r.id=Rs++,r.size=r.size||1,r.type=r.type||(r.data.constructor===Float32Array?this.gl.FLOAT:r.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),r.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,r.normalized=r.normalized||!1,r.stride=r.stride||0,r.offset=r.offset||0,r.count=r.count||r.data.length/r.size,r.divisor=r.instanced||0,r.needsUpdate=!1,r.buffer||(r.buffer=this.gl.createBuffer(),this.updateAttribute(r)),r.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==r.count*r.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,r.count*r.divisor);this.instancedCount=r.count*r.divisor}else e==="index"?this.drawRange.count=r.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,r.count))}updateAttribute(e){this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),this.gl.bufferData(e.target,e.data,this.gl.STATIC_DRAW),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,r){this.drawRange.start=e,this.drawRange.count=r}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((r,s)=>{if(!this.attributes[s]){console.warn(`active attribute ${s} not being supplied`);return}const h=this.attributes[s];this.gl.bindBuffer(h.target,h.buffer),this.glState.boundBuffer=h.buffer,this.gl.vertexAttribPointer(r,h.size,h.type,h.normalized,h.stride,h.offset),this.gl.enableVertexAttribArray(r),this.gl.renderer.vertexAttribDivisor(r,h.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:r=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((s,h)=>{const l=this.attributes[h];l.needsUpdate&&this.updateAttribute(l)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(r,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(r,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(r,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*2):this.gl.drawArrays(r,this.drawRange.start,this.drawRange.count)}getPositionArray(){const e=this.attributes.position;if(e.min)return[e.min,e.max];if(e.data)return e.data;if(!gr)return console.warn("No position buffer data found to compute bounds"),gr=!0}computeBoundingBox(e){e||(e=this.getPositionArray()),this.bounds||(this.bounds={min:new re,max:new re,center:new re,scale:new re,radius:1/0});const r=this.bounds.min,s=this.bounds.max,h=this.bounds.center,l=this.bounds.scale;r.set(1/0),s.set(-1/0);for(let u=0,c=e.length;u<c;u+=3){const p=e[u],w=e[u+1],E=e[u+2];r.x=Math.min(p,r.x),r.y=Math.min(w,r.y),r.z=Math.min(E,r.z),s.x=Math.max(p,s.x),s.y=Math.max(w,s.y),s.z=Math.max(E,s.z)}l.sub(s,r),h.add(r,s).divide(2)}computeBoundingSphere(e){e||(e=this.getPositionArray()),this.bounds||this.computeBoundingBox(e);let r=0;for(let s=0,h=e.length;s<h;s+=3)dr.fromArray(e,s),r=Math.max(r,this.bounds.center.squaredDistance(dr));this.bounds.radius=Math.sqrt(r)}remove(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let ks=1;const pr={};class Rt{constructor(e,{vertex:r,fragment:s,uniforms:h={},transparent:l=!1,cullFace:u=e.BACK,frontFace:c=e.CCW,depthTest:p=!0,depthWrite:w=!0,depthFunc:E=e.LESS}={}){this.gl=e,this.uniforms=h,this.id=ks++,r||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=l,this.cullFace=u,this.frontFace=c,this.depthTest=p,this.depthWrite=w,this.depthFunc=E,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const M=e.createShader(e.VERTEX_SHADER);e.shaderSource(M,r),e.compileShader(M),e.getShaderInfoLog(M)!==""&&console.warn(`${e.getShaderInfoLog(M)}
Vertex Shader
${vr(r)}`);const v=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(v,s),e.compileShader(v),e.getShaderInfoLog(v)!==""&&console.warn(`${e.getShaderInfoLog(v)}
Fragment Shader
${vr(s)}`),this.program=e.createProgram(),e.attachShader(this.program,M),e.attachShader(this.program,v),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(M),e.deleteShader(v),this.uniformLocations=new Map;let y=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS);for(let S=0;S<y;S++){let N=e.getActiveUniform(this.program,S);this.uniformLocations.set(N,e.getUniformLocation(this.program,N.name));const x=N.name.match(/(\w+)/g);N.uniformName=x[0],x.length===3?(N.isStructArray=!0,N.structIndex=Number(x[1]),N.structProperty=x[2]):x.length===2&&isNaN(Number(x[1]))&&(N.isStruct=!0,N.structProperty=x[1])}this.attributeLocations=new Map;const T=[],P=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES);for(let S=0;S<P;S++){const N=e.getActiveAttrib(this.program,S),x=e.getAttribLocation(this.program,N.name);T[x]=N.name,this.attributeLocations.set(N.name,x)}this.attributeOrder=T.join("")}setBlendFunc(e,r,s,h){this.blendFunc.src=e,this.blendFunc.dst=r,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=h,e&&(this.transparent=!0)}setBlendEquation(e,r){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=r}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:e=!1}={}){let r=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((h,l)=>{let u=l.uniformName,c=this.uniforms[u];if(l.isStruct&&(c=c[l.structProperty],u+=`.${l.structProperty}`),l.isStructArray&&(c=c[l.structIndex][l.structProperty],u+=`[${l.structIndex}].${l.structProperty}`),!c)return br(`Active uniform ${u} has not been supplied`);if(c&&c.value===void 0)return br(`${u} uniform is missing a value parameter`);if(c.value.texture)return r=r+1,c.value.update(r),Et(this.gl,l.type,h,r);if(c.value.length&&c.value[0].texture){const p=[];return c.value.forEach(w=>{r=r+1,w.update(r),p.push(r)}),Et(this.gl,l.type,h,p)}Et(this.gl,l.type,h,c.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function Et(t,e,r,s){s=s.length?Ss(s):s;const h=t.renderer.state.uniformLocations.get(r);if(s.length)if(h===void 0)t.renderer.state.uniformLocations.set(r,s.slice(0));else{if(Ns(h,s))return;h.set?h.set(s):Ps(h,s),t.renderer.state.uniformLocations.set(r,h)}else{if(h===s)return;t.renderer.state.uniformLocations.set(r,s)}switch(e){case 5126:return s.length?t.uniform1fv(r,s):t.uniform1f(r,s);case 35664:return t.uniform2fv(r,s);case 35665:return t.uniform3fv(r,s);case 35666:return t.uniform4fv(r,s);case 35670:case 5124:case 35678:case 35680:return s.length?t.uniform1iv(r,s):t.uniform1i(r,s);case 35671:case 35667:return t.uniform2iv(r,s);case 35672:case 35668:return t.uniform3iv(r,s);case 35673:case 35669:return t.uniform4iv(r,s);case 35674:return t.uniformMatrix2fv(r,!1,s);case 35675:return t.uniformMatrix3fv(r,!1,s);case 35676:return t.uniformMatrix4fv(r,!1,s)}}function vr(t){let e=t.split(`
`);for(let r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join(`
`)}function Ss(t){const e=t.length,r=t[0].length;if(r===void 0)return t;const s=e*r;let h=pr[s];h||(pr[s]=h=new Float32Array(s));for(let l=0;l<e;l++)h.set(t[l],l*r);return h}function Ns(t,e){if(t.length!==e.length)return!1;for(let r=0,s=t.length;r<s;r++)if(t[r]!==e[r])return!1;return!0}function Ps(t,e){for(let r=0,s=t.length;r<s;r++)t[r]=e[r]}let Mt=0;function br(t){Mt>100||(console.warn(t),Mt++,Mt>100&&console.warn("More than 100 program warnings - stopping logs."))}const _t=new re;class zs{constructor({canvas:e=document.createElement("canvas"),width:r=300,height:s=150,dpr:h=1,alpha:l=!1,depth:u=!0,stencil:c=!1,antialias:p=!1,premultipliedAlpha:w=!1,preserveDrawingBuffer:E=!1,powerPreference:M="default",autoClear:v=!0,webgl:y=2}={}){const T={alpha:l,depth:u,stencil:c,antialias:p,premultipliedAlpha:w,preserveDrawingBuffer:E,powerPreference:M};this.dpr=h,this.alpha=l,this.color=!0,this.depth=u,this.stencil=c,this.premultipliedAlpha=w,this.autoClear=v,y===2&&(this.gl=e.getContext("webgl2",T)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",T)||e.getContext("experimental-webgl",T)),this.gl.renderer=this,this.setSize(r,s),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,r){this.width=e,this.height=r,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=r*this.dpr,Object.assign(this.gl.canvas.style,{width:e+"px",height:r+"px"})}setViewport(e,r){this.state.viewport.width===e&&this.state.viewport.height===r||(this.state.viewport.width=e,this.state.viewport.height=r,this.gl.viewport(0,0,e,r))}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,r,s,h){this.state.blendFunc.src===e&&this.state.blendFunc.dst===r&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===h||(this.state.blendFunc.src=e,this.state.blendFunc.dst=r,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=h,s!==void 0?this.gl.blendFuncSeparate(e,r,s,h):this.gl.blendFunc(e,r))}setBlendEquation(e,r){this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===r||(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=r,r!==void 0?this.gl.blendEquationSeparate(e,r):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:r=null}={}){this.state.framebuffer!==r&&(this.state.framebuffer=r,this.gl.bindFramebuffer(e,r))}getExtension(e,r,s){return r&&this.gl[r]?this.gl[r].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),r?this.extensions[e]?this.extensions[e][s].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.program.id!==r.program.id?e.program.id-r.program.id:e.zDepth!==r.zDepth?e.zDepth-r.zDepth:r.id-e.id}sortTransparent(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.zDepth!==r.zDepth?r.zDepth-e.zDepth:r.id-e.id}sortUI(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.program.id!==r.program.id?e.program.id-r.program.id:r.id-e.id}getRenderList({scene:e,camera:r,frustumCull:s,sort:h}){let l=[];if(r&&s&&r.updateFrustum(),e.traverse(u=>{if(!u.visible)return!0;u.draw&&(s&&u.frustumCulled&&r&&!r.frustumIntersectsMesh(u)||l.push(u))}),h){const u=[],c=[],p=[];l.forEach(w=>{w.program.transparent?w.program.depthTest?c.push(w):p.push(w):u.push(w),w.zDepth=0,!(w.renderOrder!==0||!w.program.depthTest||!r)&&(w.worldMatrix.getTranslation(_t),_t.applyMatrix4(r.projectionViewMatrix),w.zDepth=_t.z)}),u.sort(this.sortOpaque),c.sort(this.sortTransparent),p.sort(this.sortUI),l=u.concat(c,p)}return l}render({scene:e,camera:r,target:s=null,update:h=!0,sort:l=!0,frustumCull:u=!0,clear:c}){s===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),(c||this.autoClear&&c!==!1)&&(this.depth&&(!s||s.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),h&&e.updateMatrixWorld(),r&&r.updateMatrixWorld(),this.getRenderList({scene:e,camera:r,frustumCull:u,sort:l}).forEach(w=>{w.draw({camera:r})})}}function Cs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ds(t,e,r,s,h){return t[0]=e,t[1]=r,t[2]=s,t[3]=h,t}function Ls(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=r*r+s*s+h*h+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=r*u,t[1]=s*u,t[2]=h*u,t[3]=l*u,t}function Is(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Os(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function $s(t,e,r){r=r*.5;let s=Math.sin(r);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(r),t}function mr(t,e,r){let s=e[0],h=e[1],l=e[2],u=e[3],c=r[0],p=r[1],w=r[2],E=r[3];return t[0]=s*E+u*c+h*w-l*p,t[1]=h*E+u*p+l*c-s*w,t[2]=l*E+u*w+s*p-h*c,t[3]=u*E-s*c-h*p-l*w,t}function Bs(t,e,r){r*=.5;let s=e[0],h=e[1],l=e[2],u=e[3],c=Math.sin(r),p=Math.cos(r);return t[0]=s*p+u*c,t[1]=h*p+l*c,t[2]=l*p-h*c,t[3]=u*p-s*c,t}function Us(t,e,r){r*=.5;let s=e[0],h=e[1],l=e[2],u=e[3],c=Math.sin(r),p=Math.cos(r);return t[0]=s*p-l*c,t[1]=h*p+u*c,t[2]=l*p+s*c,t[3]=u*p-h*c,t}function Gs(t,e,r){r*=.5;let s=e[0],h=e[1],l=e[2],u=e[3],c=Math.sin(r),p=Math.cos(r);return t[0]=s*p+h*c,t[1]=h*p-s*c,t[2]=l*p+u*c,t[3]=u*p-l*c,t}function qs(t,e,r,s){let h=e[0],l=e[1],u=e[2],c=e[3],p=r[0],w=r[1],E=r[2],M=r[3],v,y,T,P,S;return y=h*p+l*w+u*E+c*M,y<0&&(y=-y,p=-p,w=-w,E=-E,M=-M),1-y>1e-6?(v=Math.acos(y),T=Math.sin(v),P=Math.sin((1-s)*v)/T,S=Math.sin(s*v)/T):(P=1-s,S=s),t[0]=P*h+S*p,t[1]=P*l+S*w,t[2]=P*u+S*E,t[3]=P*c+S*M,t}function Xs(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=r*r+s*s+h*h+l*l,c=u?1/u:0;return t[0]=-r*c,t[1]=-s*c,t[2]=-h*c,t[3]=l*c,t}function Vs(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ys(t,e){let r=e[0]+e[4]+e[8],s;if(r>0)s=Math.sqrt(r+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{let h=0;e[4]>e[0]&&(h=1),e[8]>e[h*3+h]&&(h=2);let l=(h+1)%3,u=(h+2)%3;s=Math.sqrt(e[h*3+h]-e[l*3+l]-e[u*3+u]+1),t[h]=.5*s,s=.5/s,t[3]=(e[l*3+u]-e[u*3+l])*s,t[l]=(e[l*3+h]+e[h*3+l])*s,t[u]=(e[u*3+h]+e[h*3+u])*s}return t}function Ws(t,e,r="YXZ"){let s=Math.sin(e[0]*.5),h=Math.cos(e[0]*.5),l=Math.sin(e[1]*.5),u=Math.cos(e[1]*.5),c=Math.sin(e[2]*.5),p=Math.cos(e[2]*.5);return r==="XYZ"?(t[0]=s*u*p+h*l*c,t[1]=h*l*p-s*u*c,t[2]=h*u*c+s*l*p,t[3]=h*u*p-s*l*c):r==="YXZ"?(t[0]=s*u*p+h*l*c,t[1]=h*l*p-s*u*c,t[2]=h*u*c-s*l*p,t[3]=h*u*p+s*l*c):r==="ZXY"?(t[0]=s*u*p-h*l*c,t[1]=h*l*p+s*u*c,t[2]=h*u*c+s*l*p,t[3]=h*u*p-s*l*c):r==="ZYX"?(t[0]=s*u*p-h*l*c,t[1]=h*l*p+s*u*c,t[2]=h*u*c-s*l*p,t[3]=h*u*p+s*l*c):r==="YZX"?(t[0]=s*u*p+h*l*c,t[1]=h*l*p+s*u*c,t[2]=h*u*c-s*l*p,t[3]=h*u*p-s*l*c):r==="XZY"&&(t[0]=s*u*p-h*l*c,t[1]=h*l*p-s*u*c,t[2]=h*u*c+s*l*p,t[3]=h*u*p+s*l*c),t}const Hs=Cs,js=Ds,Zs=Is,Qs=Ls;class Ks extends Array{constructor(e=0,r=0,s=0,h=1){return super(e,r,s,h),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set w(e){this[3]=e,this.onChange()}identity(){return Os(this),this.onChange(),this}set(e,r,s,h){return e.length?this.copy(e):(js(this,e,r,s,h),this.onChange(),this)}rotateX(e){return Bs(this,this,e),this.onChange(),this}rotateY(e){return Us(this,this,e),this.onChange(),this}rotateZ(e){return Gs(this,this,e),this.onChange(),this}inverse(e=this){return Xs(this,e),this.onChange(),this}conjugate(e=this){return Vs(this,e),this.onChange(),this}copy(e){return Hs(this,e),this.onChange(),this}normalize(e=this){return Qs(this,e),this.onChange(),this}multiply(e,r){return r?mr(this,e,r):mr(this,this,e),this.onChange(),this}dot(e){return Zs(this,e)}fromMatrix3(e){return Ys(this,e),this.onChange(),this}fromEuler(e){return Ws(this,e,e.order),this}fromAxisAngle(e,r){return $s(this,e,r),this}slerp(e,r){return qs(this,this,e,r),this}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this[2]=e[r+2],this[3]=e[r+3],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e[r+2]=this[2],e[r+3]=this[3],e}}const Js=1e-6;function ea(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ta(t,e,r,s,h,l,u,c,p,w,E,M,v,y,T,P,S){return t[0]=e,t[1]=r,t[2]=s,t[3]=h,t[4]=l,t[5]=u,t[6]=c,t[7]=p,t[8]=w,t[9]=E,t[10]=M,t[11]=v,t[12]=y,t[13]=T,t[14]=P,t[15]=S,t}function ra(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function na(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=e[4],c=e[5],p=e[6],w=e[7],E=e[8],M=e[9],v=e[10],y=e[11],T=e[12],P=e[13],S=e[14],N=e[15],x=r*c-s*u,D=r*p-h*u,F=r*w-l*u,U=s*p-h*c,O=s*w-l*c,K=h*w-l*p,J=E*P-M*T,te=E*S-v*T,L=E*N-y*T,H=M*S-v*P,W=M*N-y*P,j=v*N-y*S,B=x*j-D*W+F*H+U*L-O*te+K*J;return B?(B=1/B,t[0]=(c*j-p*W+w*H)*B,t[1]=(h*W-s*j-l*H)*B,t[2]=(P*K-S*O+N*U)*B,t[3]=(v*O-M*K-y*U)*B,t[4]=(p*L-u*j-w*te)*B,t[5]=(r*j-h*L+l*te)*B,t[6]=(S*F-T*K-N*D)*B,t[7]=(E*K-v*F+y*D)*B,t[8]=(u*W-c*L+w*J)*B,t[9]=(s*L-r*W-l*J)*B,t[10]=(T*O-P*F+N*x)*B,t[11]=(M*F-E*O-y*x)*B,t[12]=(c*te-u*H-p*J)*B,t[13]=(r*H-s*te+h*J)*B,t[14]=(P*D-T*U-S*x)*B,t[15]=(E*U-M*D+v*x)*B,t):null}function ia(t){let e=t[0],r=t[1],s=t[2],h=t[3],l=t[4],u=t[5],c=t[6],p=t[7],w=t[8],E=t[9],M=t[10],v=t[11],y=t[12],T=t[13],P=t[14],S=t[15],N=e*u-r*l,x=e*c-s*l,D=e*p-h*l,F=r*c-s*u,U=r*p-h*u,O=s*p-h*c,K=w*T-E*y,J=w*P-M*y,te=w*S-v*y,L=E*P-M*T,H=E*S-v*T,W=M*S-v*P;return N*W-x*H+D*L+F*te-U*J+O*K}function yr(t,e,r){let s=e[0],h=e[1],l=e[2],u=e[3],c=e[4],p=e[5],w=e[6],E=e[7],M=e[8],v=e[9],y=e[10],T=e[11],P=e[12],S=e[13],N=e[14],x=e[15],D=r[0],F=r[1],U=r[2],O=r[3];return t[0]=D*s+F*c+U*M+O*P,t[1]=D*h+F*p+U*v+O*S,t[2]=D*l+F*w+U*y+O*N,t[3]=D*u+F*E+U*T+O*x,D=r[4],F=r[5],U=r[6],O=r[7],t[4]=D*s+F*c+U*M+O*P,t[5]=D*h+F*p+U*v+O*S,t[6]=D*l+F*w+U*y+O*N,t[7]=D*u+F*E+U*T+O*x,D=r[8],F=r[9],U=r[10],O=r[11],t[8]=D*s+F*c+U*M+O*P,t[9]=D*h+F*p+U*v+O*S,t[10]=D*l+F*w+U*y+O*N,t[11]=D*u+F*E+U*T+O*x,D=r[12],F=r[13],U=r[14],O=r[15],t[12]=D*s+F*c+U*M+O*P,t[13]=D*h+F*p+U*v+O*S,t[14]=D*l+F*w+U*y+O*N,t[15]=D*u+F*E+U*T+O*x,t}function sa(t,e,r){let s=r[0],h=r[1],l=r[2],u,c,p,w,E,M,v,y,T,P,S,N;return e===t?(t[12]=e[0]*s+e[4]*h+e[8]*l+e[12],t[13]=e[1]*s+e[5]*h+e[9]*l+e[13],t[14]=e[2]*s+e[6]*h+e[10]*l+e[14],t[15]=e[3]*s+e[7]*h+e[11]*l+e[15]):(u=e[0],c=e[1],p=e[2],w=e[3],E=e[4],M=e[5],v=e[6],y=e[7],T=e[8],P=e[9],S=e[10],N=e[11],t[0]=u,t[1]=c,t[2]=p,t[3]=w,t[4]=E,t[5]=M,t[6]=v,t[7]=y,t[8]=T,t[9]=P,t[10]=S,t[11]=N,t[12]=u*s+E*h+T*l+e[12],t[13]=c*s+M*h+P*l+e[13],t[14]=p*s+v*h+S*l+e[14],t[15]=w*s+y*h+N*l+e[15]),t}function aa(t,e,r){let s=r[0],h=r[1],l=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ha(t,e,r,s){let h=s[0],l=s[1],u=s[2],c=Math.hypot(h,l,u),p,w,E,M,v,y,T,P,S,N,x,D,F,U,O,K,J,te,L,H,W,j,B,de;return Math.abs(c)<Js?null:(c=1/c,h*=c,l*=c,u*=c,p=Math.sin(r),w=Math.cos(r),E=1-w,M=e[0],v=e[1],y=e[2],T=e[3],P=e[4],S=e[5],N=e[6],x=e[7],D=e[8],F=e[9],U=e[10],O=e[11],K=h*h*E+w,J=l*h*E+u*p,te=u*h*E-l*p,L=h*l*E-u*p,H=l*l*E+w,W=u*l*E+h*p,j=h*u*E+l*p,B=l*u*E-h*p,de=u*u*E+w,t[0]=M*K+P*J+D*te,t[1]=v*K+S*J+F*te,t[2]=y*K+N*J+U*te,t[3]=T*K+x*J+O*te,t[4]=M*L+P*H+D*W,t[5]=v*L+S*H+F*W,t[6]=y*L+N*H+U*W,t[7]=T*L+x*H+O*W,t[8]=M*j+P*B+D*de,t[9]=v*j+S*B+F*de,t[10]=y*j+N*B+U*de,t[11]=T*j+x*B+O*de,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function la(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ir(t,e){let r=e[0],s=e[1],h=e[2],l=e[4],u=e[5],c=e[6],p=e[8],w=e[9],E=e[10];return t[0]=Math.hypot(r,s,h),t[1]=Math.hypot(l,u,c),t[2]=Math.hypot(p,w,E),t}function fa(t){let e=t[0],r=t[1],s=t[2],h=t[4],l=t[5],u=t[6],c=t[8],p=t[9],w=t[10];const E=e*e+r*r+s*s,M=h*h+l*l+u*u,v=c*c+p*p+w*w;return Math.sqrt(Math.max(E,M,v))}const ua=function(){const t=[0,0,0];return function(e,r){let s=t;Ir(s,r);let h=1/s[0],l=1/s[1],u=1/s[2],c=r[0]*h,p=r[1]*l,w=r[2]*u,E=r[4]*h,M=r[5]*l,v=r[6]*u,y=r[8]*h,T=r[9]*l,P=r[10]*u,S=c+M+P,N=0;return S>0?(N=Math.sqrt(S+1)*2,e[3]=.25*N,e[0]=(v-T)/N,e[1]=(y-w)/N,e[2]=(p-E)/N):c>M&&c>P?(N=Math.sqrt(1+c-M-P)*2,e[3]=(v-T)/N,e[0]=.25*N,e[1]=(p+E)/N,e[2]=(y+w)/N):M>P?(N=Math.sqrt(1+M-c-P)*2,e[3]=(y-w)/N,e[0]=(p+E)/N,e[1]=.25*N,e[2]=(v+T)/N):(N=Math.sqrt(1+P-c-M)*2,e[3]=(p-E)/N,e[0]=(y+w)/N,e[1]=(v+T)/N,e[2]=.25*N),e}}();function ca(t,e,r,s){let h=e[0],l=e[1],u=e[2],c=e[3],p=h+h,w=l+l,E=u+u,M=h*p,v=h*w,y=h*E,T=l*w,P=l*E,S=u*E,N=c*p,x=c*w,D=c*E,F=s[0],U=s[1],O=s[2];return t[0]=(1-(T+S))*F,t[1]=(v+D)*F,t[2]=(y-x)*F,t[3]=0,t[4]=(v-D)*U,t[5]=(1-(M+S))*U,t[6]=(P+N)*U,t[7]=0,t[8]=(y+x)*O,t[9]=(P-N)*O,t[10]=(1-(M+T))*O,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function oa(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=r+r,c=s+s,p=h+h,w=r*u,E=s*u,M=s*c,v=h*u,y=h*c,T=h*p,P=l*u,S=l*c,N=l*p;return t[0]=1-M-T,t[1]=E+N,t[2]=v-S,t[3]=0,t[4]=E-N,t[5]=1-w-T,t[6]=y+P,t[7]=0,t[8]=v+S,t[9]=y-P,t[10]=1-w-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function da(t,e,r,s,h){let l=1/Math.tan(e/2),u=1/(s-h);return t[0]=l/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(h+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*h*s*u,t[15]=0,t}function ga(t,e,r,s,h,l,u){let c=1/(e-r),p=1/(s-h),w=1/(l-u);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+r)*c,t[13]=(h+s)*p,t[14]=(u+l)*w,t[15]=1,t}function pa(t,e,r,s){let h=e[0],l=e[1],u=e[2],c=s[0],p=s[1],w=s[2],E=h-r[0],M=l-r[1],v=u-r[2],y=E*E+M*M+v*v;y>0&&(y=1/Math.sqrt(y),E*=y,M*=y,v*=y);let T=p*v-w*M,P=w*E-c*v,S=c*M-p*E;return y=T*T+P*P+S*S,y>0&&(y=1/Math.sqrt(y),T*=y,P*=y,S*=y),t[0]=T,t[1]=P,t[2]=S,t[3]=0,t[4]=M*S-v*P,t[5]=v*T-E*S,t[6]=E*P-M*T,t[7]=0,t[8]=E,t[9]=M,t[10]=v,t[11]=0,t[12]=h,t[13]=l,t[14]=u,t[15]=1,t}class me extends Array{constructor(e=1,r=0,s=0,h=0,l=0,u=1,c=0,p=0,w=0,E=0,M=1,v=0,y=0,T=0,P=0,S=1){return super(e,r,s,h,l,u,c,p,w,E,M,v,y,T,P,S),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,r,s,h,l,u,c,p,w,E,M,v,y,T,P,S){return e.length?this.copy(e):(ta(this,e,r,s,h,l,u,c,p,w,E,M,v,y,T,P,S),this)}translate(e,r=this){return sa(this,r,e),this}rotate(e,r,s=this){return ha(out,s,e,r),this}scale(e,r=this){return aa(this,r,typeof e=="number"?[e,e,e]:e),this}multiply(e,r){return r?yr(this,e,r):yr(this,this,e),this}identity(){return ra(this),this}copy(e){return ea(this,e),this}fromPerspective({fov:e,aspect:r,near:s,far:h}={}){return da(this,e,r,s,h),this}fromOrthogonal({left:e,right:r,bottom:s,top:h,near:l,far:u}){return ga(this,e,r,s,h,l,u),this}fromQuaternion(e){return oa(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return na(this,e),this}compose(e,r,s){return ca(this,e,r,s),this}getRotation(e){return ua(e,this),this}getTranslation(e){return la(e,this),this}getScaling(e){return Ir(e,this),this}getMaxScaleOnAxis(){return fa(this)}lookAt(e,r,s){return pa(this,e,r,s),this}determinant(){return ia(this)}}function va(t,e,r="YXZ"){return r==="XYZ"?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):r==="YXZ"?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):r==="ZXY"?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):r==="ZYX"?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):r==="YZX"?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):r==="XZY"&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}const wr=new me;class ba extends Array{constructor(e=0,r=e,s=e,h="YXZ"){return super(e,r,s),this.order=h,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e,this.onChange()}set y(e){this[1]=e,this.onChange()}set z(e){this[2]=e,this.onChange()}set(e,r=e,s=e){return e.length?this.copy(e):(this[0]=e,this[1]=r,this[2]=s,this.onChange(),this)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.onChange(),this}reorder(e){return this.order=e,this.onChange(),this}fromRotationMatrix(e,r=this.order){return va(this,e,r),this}fromQuaternion(e,r=this.order){return wr.fromQuaternion(e),this.fromRotationMatrix(wr,r)}}class Or{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new me,this.worldMatrix=new me,this.matrixAutoUpdate=!0,this.position=new re,this.quaternion=new Ks,this.scale=new re(1),this.rotation=new ba,this.up=new re(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(e,r=!0){r&&this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,r&&e&&e.addChild(this,!1)}addChild(e,r=!0){~this.children.indexOf(e)||this.children.push(e),r&&e.setParent(this,!1)}removeChild(e,r=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),r&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let r=0,s=this.children.length;r<s;r++)this.children[r].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let r=0,s=this.children.length;r<s;r++)this.children[r].traverse(e)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,r=!1){r?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const ma=new me,ya=new re,wa=new re;class xa extends Or{constructor(e,{near:r=.1,far:s=100,fov:h=45,aspect:l=1,left:u,right:c,bottom:p,top:w,zoom:E=1}={}){super(),Object.assign(this,{near:r,far:s,fov:h,aspect:l,left:u,right:c,bottom:p,top:w,zoom:E}),this.projectionMatrix=new me,this.viewMatrix=new me,this.projectionViewMatrix=new me,this.worldPosition=new re,this.type=u||c?"orthographic":"perspective",this.type==="orthographic"?this.orthographic():this.perspective()}perspective({near:e=this.near,far:r=this.far,fov:s=this.fov,aspect:h=this.aspect}={}){return Object.assign(this,{near:e,far:r,fov:s,aspect:h}),this.projectionMatrix.fromPerspective({fov:s*(Math.PI/180),aspect:h,near:e,far:r}),this.type="perspective",this}orthographic({near:e=this.near,far:r=this.far,left:s=this.left,right:h=this.right,bottom:l=this.bottom,top:u=this.top,zoom:c=this.zoom}={}){return Object.assign(this,{near:e,far:r,left:s,right:h,bottom:l,top:u,zoom:c}),s/=c,h/=c,l/=c,u/=c,this.projectionMatrix.fromOrthogonal({left:s,right:h,bottom:l,top:u,near:e,far:r}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(e){return super.lookAt(e,!0),this}project(e){return e.applyMatrix4(this.viewMatrix),e.applyMatrix4(this.projectionMatrix),this}unproject(e){return e.applyMatrix4(ma.inverse(this.projectionMatrix)),e.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new re,new re,new re,new re,new re,new re]);const e=this.projectionViewMatrix;this.frustum[0].set(e[3]-e[0],e[7]-e[4],e[11]-e[8]).constant=e[15]-e[12],this.frustum[1].set(e[3]+e[0],e[7]+e[4],e[11]+e[8]).constant=e[15]+e[12],this.frustum[2].set(e[3]+e[1],e[7]+e[5],e[11]+e[9]).constant=e[15]+e[13],this.frustum[3].set(e[3]-e[1],e[7]-e[5],e[11]-e[9]).constant=e[15]-e[13],this.frustum[4].set(e[3]-e[2],e[7]-e[6],e[11]-e[10]).constant=e[15]-e[14],this.frustum[5].set(e[3]+e[2],e[7]+e[6],e[11]+e[10]).constant=e[15]+e[14];for(let r=0;r<6;r++){const s=1/this.frustum[r].distance();this.frustum[r].multiply(s),this.frustum[r].constant*=s}}frustumIntersectsMesh(e){if(!e.geometry.attributes.position||((!e.geometry.bounds||e.geometry.bounds.radius===1/0)&&e.geometry.computeBoundingSphere(),!e.geometry.bounds))return!0;const r=ya;r.copy(e.geometry.bounds.center),r.applyMatrix4(e.worldMatrix);const s=e.geometry.bounds.radius*e.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(r,s)}frustumIntersectsSphere(e,r){const s=wa;for(let h=0;h<6;h++){const l=this.frustum[h];if(s.copy(l).dot(e)+l.constant<-r)return!1}return!0}}function Ea(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Ma(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=r+r,c=s+s,p=h+h,w=r*u,E=s*u,M=s*c,v=h*u,y=h*c,T=h*p,P=l*u,S=l*c,N=l*p;return t[0]=1-M-T,t[3]=E-N,t[6]=v+S,t[1]=E+N,t[4]=1-w-T,t[7]=y-P,t[2]=v-S,t[5]=y+P,t[8]=1-w-M,t}function _a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Aa(t,e,r,s,h,l,u,c,p,w){return t[0]=e,t[1]=r,t[2]=s,t[3]=h,t[4]=l,t[5]=u,t[6]=c,t[7]=p,t[8]=w,t}function Fa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ta(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=e[4],c=e[5],p=e[6],w=e[7],E=e[8],M=E*u-c*w,v=-E*l+c*p,y=w*l-u*p,T=r*M+s*v+h*y;return T?(T=1/T,t[0]=M*T,t[1]=(-E*s+h*w)*T,t[2]=(c*s-h*u)*T,t[3]=v*T,t[4]=(E*r-h*p)*T,t[5]=(-c*r+h*l)*T,t[6]=y*T,t[7]=(-w*r+s*p)*T,t[8]=(u*r-s*l)*T,t):null}function xr(t,e,r){let s=e[0],h=e[1],l=e[2],u=e[3],c=e[4],p=e[5],w=e[6],E=e[7],M=e[8],v=r[0],y=r[1],T=r[2],P=r[3],S=r[4],N=r[5],x=r[6],D=r[7],F=r[8];return t[0]=v*s+y*u+T*w,t[1]=v*h+y*c+T*E,t[2]=v*l+y*p+T*M,t[3]=P*s+S*u+N*w,t[4]=P*h+S*c+N*E,t[5]=P*l+S*p+N*M,t[6]=x*s+D*u+F*w,t[7]=x*h+D*c+F*E,t[8]=x*l+D*p+F*M,t}function Ra(t,e,r){let s=e[0],h=e[1],l=e[2],u=e[3],c=e[4],p=e[5],w=e[6],E=e[7],M=e[8],v=r[0],y=r[1];return t[0]=s,t[1]=h,t[2]=l,t[3]=u,t[4]=c,t[5]=p,t[6]=v*s+y*u+w,t[7]=v*h+y*c+E,t[8]=v*l+y*p+M,t}function ka(t,e,r){let s=e[0],h=e[1],l=e[2],u=e[3],c=e[4],p=e[5],w=e[6],E=e[7],M=e[8],v=Math.sin(r),y=Math.cos(r);return t[0]=y*s+v*u,t[1]=y*h+v*c,t[2]=y*l+v*p,t[3]=y*u-v*s,t[4]=y*c-v*h,t[5]=y*p-v*l,t[6]=w,t[7]=E,t[8]=M,t}function Sa(t,e,r){let s=r[0],h=r[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=h*e[3],t[4]=h*e[4],t[5]=h*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Na(t,e){let r=e[0],s=e[1],h=e[2],l=e[3],u=e[4],c=e[5],p=e[6],w=e[7],E=e[8],M=e[9],v=e[10],y=e[11],T=e[12],P=e[13],S=e[14],N=e[15],x=r*c-s*u,D=r*p-h*u,F=r*w-l*u,U=s*p-h*c,O=s*w-l*c,K=h*w-l*p,J=E*P-M*T,te=E*S-v*T,L=E*N-y*T,H=M*S-v*P,W=M*N-y*P,j=v*N-y*S,B=x*j-D*W+F*H+U*L-O*te+K*J;return B?(B=1/B,t[0]=(c*j-p*W+w*H)*B,t[1]=(p*L-u*j-w*te)*B,t[2]=(u*W-c*L+w*J)*B,t[3]=(h*W-s*j-l*H)*B,t[4]=(r*j-h*L+l*te)*B,t[5]=(s*L-r*W-l*J)*B,t[6]=(P*K-S*O+N*U)*B,t[7]=(S*F-T*K-N*D)*B,t[8]=(T*O-P*F+N*x)*B,t):null}class Pa extends Array{constructor(e=1,r=0,s=0,h=0,l=1,u=0,c=0,p=0,w=1){return super(e,r,s,h,l,u,c,p,w),this}set(e,r,s,h,l,u,c,p,w){return e.length?this.copy(e):(Aa(this,e,r,s,h,l,u,c,p,w),this)}translate(e,r=this){return Ra(this,r,e),this}rotate(e,r=this){return ka(this,r,e),this}scale(e,r=this){return Sa(this,r,e),this}multiply(e,r){return r?xr(this,e,r):xr(this,this,e),this}identity(){return Fa(this),this}copy(e){return _a(this,e),this}fromMatrix4(e){return Ea(this,e),this}fromQuaternion(e){return Ma(this,e),this}fromBasis(e,r,s){return this.set(e[0],e[1],e[2],r[0],r[1],r[2],s[0],s[1],s[2]),this}inverse(e=this){return Ta(this,e),this}getNormalMatrix(e){return Na(this,e),this}}let za=0;class $r extends Or{constructor(e,{geometry:r,program:s,mode:h=e.TRIANGLES,frustumCulled:l=!0,renderOrder:u=0}={}){super(),this.gl=e,this.id=za++,this.geometry=r,this.program=s,this.mode=h,this.frustumCulled=l,this.renderOrder=u,this.modelViewMatrix=new me,this.normalMatrix=new Pa,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){this.beforeRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:e})),e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let r=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:r}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:e}))}}const Er=new Uint8Array(4);function Mr(t){return(t&t-1)===0}let Ca=1;class _r{constructor(e,{image:r,target:s=e.TEXTURE_2D,type:h=e.UNSIGNED_BYTE,format:l=e.RGBA,internalFormat:u=l,wrapS:c=e.CLAMP_TO_EDGE,wrapT:p=e.CLAMP_TO_EDGE,generateMipmaps:w=!0,minFilter:E=w?e.NEAREST_MIPMAP_LINEAR:e.LINEAR,magFilter:M=e.LINEAR,premultiplyAlpha:v=!1,unpackAlignment:y=4,flipY:T=s==e.TEXTURE_2D,anisotropy:P=0,level:S=0,width:N,height:x=N}={}){this.gl=e,this.id=Ca++,this.image=r,this.target=s,this.type=h,this.format=l,this.internalFormat=u,this.minFilter=E,this.magFilter=M,this.wrapS=c,this.wrapT=p,this.generateMipmaps=w,this.premultiplyAlpha=v,this.unpackAlignment=y,this.flipY=T,this.anisotropy=Math.min(P,this.gl.renderer.parameters.maxAnisotropy),this.level=S,this.width=N,this.height=x,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(e=0){const r=!(this.image===this.store.image&&!this.needsUpdate);if((r||this.glState.textureUnits[e]!==this.id)&&(this.gl.renderer.activeTexture(e),this.bind()),!!r){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let s=0;s<6;s++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,this.level,this.internalFormat,this.format,this.type,this.image[s]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let s=0;s<this.image.length;s++)this.gl.compressedTexImage2D(this.target,s,this.internalFormat,this.image[s].width,this.image[s].height,0,this.image[s].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!Mr(this.image.width)||!Mr(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let s=0;s<6;s++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Er);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Er);this.store.image=this.image}}}class Ar{constructor(e,{width:r=e.canvas.width,height:s=e.canvas.height,target:h=e.FRAMEBUFFER,color:l=1,depth:u=!0,stencil:c=!1,depthTexture:p=!1,wrapS:w=e.CLAMP_TO_EDGE,wrapT:E=e.CLAMP_TO_EDGE,minFilter:M=e.LINEAR,magFilter:v=M,type:y=e.UNSIGNED_BYTE,format:T=e.RGBA,internalFormat:P=T,unpackAlignment:S,premultiplyAlpha:N}={}){this.gl=e,this.width=r,this.height=s,this.depth=u,this.buffer=this.gl.createFramebuffer(),this.target=h,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];const x=[];for(let D=0;D<l;D++)this.textures.push(new _r(e,{width:r,height:s,wrapS:w,wrapT:E,minFilter:M,magFilter:v,type:y,format:T,internalFormat:P,unpackAlignment:S,premultiplyAlpha:N,flipY:!1,generateMipmaps:!1})),this.textures[D].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+D,this.gl.TEXTURE_2D,this.textures[D].texture,0),x.push(this.gl.COLOR_ATTACHMENT0+D);x.length>1&&this.gl.renderer.drawBuffers(x),this.texture=this.textures[0],p&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new _r(e,{width:r,height:s,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:e.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(u&&!c&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,r,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),c&&!u&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,r,s),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),u&&c&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,r,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}}const Fr={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function Tr(t){t.length===4&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||console.warn(`Unable to convert hex string ${t} to rgb values`),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}function Da(t){return t=parseInt(t),[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]}function Rr(t){return t===void 0?[0,0,0]:arguments.length===3?arguments:isNaN(t)?t[0]==="#"?Tr(t):Fr[t.toLowerCase()]?Tr(Fr[t.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0]):Da(t)}class kr extends Array{constructor(e){return Array.isArray(e)?super(...e):super(...Rr(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(e){this[0]=e}set g(e){this[1]=e}set b(e){this[2]=e}set(e){return Array.isArray(e)?this.copy(e):this.copy(Rr(...arguments))}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this}}function La(t,e){return t[0]=e[0],t[1]=e[1],t}function Ia(t,e,r){return t[0]=e,t[1]=r,t}function Sr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Nr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Oa(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function $a(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function At(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Ba(t,e){var r=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(r*r+s*s)}function Ua(t,e){var r=e[0]-t[0],s=e[1]-t[1];return r*r+s*s}function Pr(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Ga(t){var e=t[0],r=t[1];return e*e+r*r}function qa(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Xa(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Va(t,e){var r=e[0],s=e[1],h=r*r+s*s;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t}function Ya(t,e){return t[0]*e[0]+t[1]*e[1]}function Wa(t,e){return t[0]*e[1]-t[1]*e[0]}function Ha(t,e,r,s){var h=e[0],l=e[1];return t[0]=h+s*(r[0]-h),t[1]=l+s*(r[1]-l),t}function ja(t,e,r){var s=e[0],h=e[1];return t[0]=r[0]*s+r[3]*h+r[6],t[1]=r[1]*s+r[4]*h+r[7],t}function Za(t,e,r){let s=e[0],h=e[1];return t[0]=r[0]*s+r[4]*h+r[12],t[1]=r[1]*s+r[5]*h+r[13],t}function Qa(t,e){return t[0]===e[0]&&t[1]===e[1]}class Ie extends Array{constructor(e=0,r=e){return super(e,r),this}get x(){return this[0]}get y(){return this[1]}set x(e){this[0]=e}set y(e){this[1]=e}set(e,r=e){return e.length?this.copy(e):(Ia(this,e,r),this)}copy(e){return La(this,e),this}add(e,r){return r?Sr(this,e,r):Sr(this,this,e),this}sub(e,r){return r?Nr(this,e,r):Nr(this,this,e),this}multiply(e){return e.length?Oa(this,this,e):At(this,this,e),this}divide(e){return e.length?$a(this,this,e):At(this,this,1/e),this}inverse(e=this){return Xa(this,e),this}len(){return Pr(this)}distance(e){return e?Ba(this,e):Pr(this)}squaredLen(){return this.squaredDistance()}squaredDistance(e){return e?Ua(this,e):Ga(this)}negate(e=this){return qa(this,e),this}cross(e,r){return Wa(e,r)}scale(e){return At(this,this,e),this}normalize(){return Va(this,this),this}dot(e){return Ya(this,e)}equals(e){return Qa(this,e)}applyMatrix3(e){return ja(this,this,e),this}applyMatrix4(e){return Za(this,this,e),this}lerp(e,r){Ha(this,this,e,r)}clone(){return new Ie(this[0],this[1])}fromArray(e,r=0){return this[0]=e[r],this[1]=e[r+1],this}toArray(e=[],r=0){return e[r]=this[0],e[r+1]=this[1],e}}class Ka extends Lr{constructor(e,{attributes:r={}}={}){Object.assign(r,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(e,r)}}function Ja(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var je={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2018, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */var eh=je.exports,zr;function th(){return zr||(zr=1,function(t,e){(function(r,s){t.exports=s()})(eh,function(){for(var r=function(n,i,a){return i===void 0&&(i=0),a===void 0&&(a=1),n<i?i:n>a?a:n},s=function(n){n._clipped=!1,n._unclipped=n.slice(0);for(var i=0;i<=3;i++)i<3?((n[i]<0||n[i]>255)&&(n._clipped=!0),n[i]=r(n[i],0,255)):i===3&&(n[i]=r(n[i],0,1));return n},h={},l=0,u=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];l<u.length;l+=1){var c=u[l];h["[object "+c+"]"]=c.toLowerCase()}var p=function(n){return h[Object.prototype.toString.call(n)]||"object"},w=function(n,i){return i===void 0&&(i=null),n.length>=3?Array.prototype.slice.call(n):p(n[0])=="object"&&i?i.split("").filter(function(a){return n[0][a]!==void 0}).map(function(a){return n[0][a]}):n[0]},E=function(n){if(n.length<2)return null;var i=n.length-1;return p(n[i])=="string"?n[i].toLowerCase():null},M=Math.PI,v={clip_rgb:s,limit:r,type:p,unpack:w,last:E,TWOPI:M*2,PITHIRD:M/3,DEG2RAD:M/180,RAD2DEG:180/M},y={format:{},autodetect:[]},T=v.last,P=v.clip_rgb,S=v.type,N=function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];var f=this;if(S(i[0])==="object"&&i[0].constructor&&i[0].constructor===this.constructor)return i[0];var o=T(i),g=!1;if(!o){g=!0,y.sorted||(y.autodetect=y.autodetect.sort(function(R,A){return A.p-R.p}),y.sorted=!0);for(var d=0,m=y.autodetect;d<m.length;d+=1){var b=m[d];if(o=b.test.apply(b,i),o)break}}if(y.format[o]){var _=y.format[o].apply(null,g?i:i.slice(0,-1));f._rgb=P(_)}else throw new Error("unknown format: "+i);f._rgb.length===3&&f._rgb.push(1)};N.prototype.toString=function(){return S(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var x=N,D=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(D.Color,[null].concat(n)))};D.Color=x,D.version="2.0.3";var F=D,U=v.unpack,O=Math.max,K=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=U(n,"rgb"),f=a[0],o=a[1],g=a[2];f=f/255,o=o/255,g=g/255;var d=1-O(f,O(o,g)),m=d<1?1/(1-d):0,b=(1-f-d)*m,_=(1-o-d)*m,R=(1-g-d)*m;return[b,_,R,d]},J=K,te=v.unpack,L=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];n=te(n,"cmyk");var a=n[0],f=n[1],o=n[2],g=n[3],d=n.length>4?n[4]:1;return g===1?[0,0,0,d]:[a>=1?0:255*(1-a)*(1-g),f>=1?0:255*(1-f)*(1-g),o>=1?0:255*(1-o)*(1-g),d]},H=L,W=v.unpack,j=v.type;x.prototype.cmyk=function(){return J(this._rgb)},F.cmyk=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["cmyk"])))},y.format.cmyk=H,y.autodetect.push({p:2,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=W(n,"cmyk"),j(n)==="array"&&n.length===4)return"cmyk"}});var B=v.unpack,de=v.last,Re=function(n){return Math.round(n*100)/100},Oe=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=B(n,"hsla"),f=de(n)||"lsa";return a[0]=Re(a[0]||0),a[1]=Re(a[1]*100)+"%",a[2]=Re(a[2]*100)+"%",f==="hsla"||a.length>3&&a[3]<1?(a[3]=a.length>3?a[3]:1,f="hsla"):a.length=3,f+"("+a.join(",")+")"},$e=Oe,Be=v.unpack,ke=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];n=Be(n,"rgba");var a=n[0],f=n[1],o=n[2];a/=255,f/=255,o/=255;var g=Math.min(a,f,o),d=Math.max(a,f,o),m=(d+g)/2,b,_;return d===g?(b=0,_=Number.NaN):b=m<.5?(d-g)/(d+g):(d-g)/(2-d-g),a==d?_=(f-o)/(d-g):f==d?_=2+(o-a)/(d-g):o==d&&(_=4+(a-f)/(d-g)),_*=60,_<0&&(_+=360),n.length>3&&n[3]!==void 0?[_,b,m,n[3]]:[_,b,m]},Ee=ke,Se=v.unpack,Ne=v.last,Me=Math.round,ge=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Se(n,"rgba"),f=Ne(n)||"rgb";return f.substr(0,3)=="hsl"?$e(Ee(a),f):(a[0]=Me(a[0]),a[1]=Me(a[1]),a[2]=Me(a[2]),(f==="rgba"||a.length>3&&a[3]<1)&&(a[3]=a.length>3?a[3]:1,f="rgba"),f+"("+a.slice(0,f==="rgb"?3:4).join(",")+")")},Ze=ge,ye=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Pe=/^#?([A-Fa-f0-9]{8})$/,Qe=function(n){if(n.match(ye)){(n.length===4||n.length===7)&&(n=n.substr(1)),n.length===3&&(n=n.split(""),n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]);var i=parseInt(n,16),a=i>>16,f=i>>8&255,o=i&255;return[a,f,o,1]}if(n.match(Pe)){n.length===9&&(n=n.substr(1));var g=parseInt(n,16),d=g>>24&255,m=g>>16&255,b=g>>8&255,_=Math.round((g&255)/255*100)/100;return[d,m,b,_]}throw new Error("unknown hex color: "+n)},ze=Qe,Ke=v.unpack,Je=Math.round,Br=function(){for(var n,i=[],a=arguments.length;a--;)i[a]=arguments[a];i=Ke(i,"hsl");var f=i[0],o=i[1],g=i[2],d,m,b;if(o===0)d=m=b=g*255;else{var _=[0,0,0],R=[0,0,0],A=g<.5?g*(1+o):g+o-g*o,z=2*g-A,C=f/360;_[0]=C+1/3,_[1]=C,_[2]=C-1/3;for(var $=0;$<3;$++)_[$]<0&&(_[$]+=1),_[$]>1&&(_[$]-=1),6*_[$]<1?R[$]=z+(A-z)*6*_[$]:2*_[$]<1?R[$]=A:3*_[$]<2?R[$]=z+(A-z)*(2/3-_[$])*6:R[$]=z;n=[Je(R[0]*255),Je(R[1]*255),Je(R[2]*255)],d=n[0],m=n[1],b=n[2]}return i.length>3?[d,m,b,i[3]]:[d,m,b,1]},et=Br,Ur={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},pe=Ur,kt=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,St=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,Nt=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Pt=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,zt=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Ct=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Dt=Math.round,Lt=function(n){if(n=n.toLowerCase().trim(),pe[n])return ze(pe[n]);var i;if(i=n.match(kt)){for(var a=i.slice(1,4),f=0;f<3;f++)a[f]=+a[f];return a[3]=1,a}if(i=n.match(St)){for(var o=i.slice(1,5),g=0;g<4;g++)o[g]=+o[g];return o}if(i=n.match(Nt)){for(var d=i.slice(1,4),m=0;m<3;m++)d[m]=Dt(d[m]*2.55);return d[3]=1,d}if(i=n.match(Pt)){for(var b=i.slice(1,5),_=0;_<3;_++)b[_]=Dt(b[_]*2.55);return b[3]=+b[3],b}if(i=n.match(zt)){var R=i.slice(1,4);R[1]*=.01,R[2]*=.01;var A=et(R);return A[3]=1,A}if(i=n.match(Ct)){var z=i.slice(1,4);z[1]*=.01,z[2]*=.01;var C=et(z);return C[3]=+i[4],C}};Lt.test=function(n){return kt.test(n)||St.test(n)||Nt.test(n)||Pt.test(n)||zt.test(n)||Ct.test(n)};var It=Lt,Gr=v.type;x.prototype.css=function(n){return Ze(this._rgb,n)},F.css=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["css"])))},y.format.css=It,y.autodetect.push({p:5,test:function(n){for(var i=[],a=arguments.length-1;a-- >0;)i[a]=arguments[a+1];if(!i.length&&Gr(n)==="string"&&It.test(n))return"css"}});var qr=v.unpack;y.format.gl=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=qr(n,"rgba");return a[0]*=255,a[1]*=255,a[2]*=255,a},F.gl=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["gl"])))},x.prototype.gl=function(){var n=this._rgb;return[n[0]/255,n[1]/255,n[2]/255,n[3]]};var Xr=v.unpack,Vr=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Xr(n,"rgb"),f=a[0],o=a[1],g=a[2],d=Math.min(f,o,g),m=Math.max(f,o,g),b=m-d,_=b*100/255,R=d/(255-b)*100,A;return b===0?A=Number.NaN:(f===m&&(A=(o-g)/b),o===m&&(A=2+(g-f)/b),g===m&&(A=4+(f-o)/b),A*=60,A<0&&(A+=360)),[A,_,R]},Yr=Vr,Wr=v.unpack,Hr=Math.floor,jr=function(){for(var n,i,a,f,o,g,d=[],m=arguments.length;m--;)d[m]=arguments[m];d=Wr(d,"hcg");var b=d[0],_=d[1],R=d[2],A,z,C;R=R*255;var $=_*255;if(_===0)A=z=C=R;else{b===360&&(b=0),b>360&&(b-=360),b<0&&(b+=360),b/=60;var q=Hr(b),V=b-q,Z=R*(1-_),ne=Z+$*(1-V),ie=Z+$*V,ae=Z+$;switch(q){case 0:n=[ae,ie,Z],A=n[0],z=n[1],C=n[2];break;case 1:i=[ne,ae,Z],A=i[0],z=i[1],C=i[2];break;case 2:a=[Z,ae,ie],A=a[0],z=a[1],C=a[2];break;case 3:f=[Z,ne,ae],A=f[0],z=f[1],C=f[2];break;case 4:o=[ie,Z,ae],A=o[0],z=o[1],C=o[2];break;case 5:g=[ae,Z,ne],A=g[0],z=g[1],C=g[2];break}}return[A,z,C,d.length>3?d[3]:1]},Zr=jr,Qr=v.unpack,Kr=v.type;x.prototype.hcg=function(){return Yr(this._rgb)},F.hcg=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["hcg"])))},y.format.hcg=Zr,y.autodetect.push({p:1,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=Qr(n,"hcg"),Kr(n)==="array"&&n.length===3)return"hcg"}});var Jr=v.unpack,en=v.last,Ue=Math.round,tn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Jr(n,"rgba"),f=a[0],o=a[1],g=a[2],d=a[3],m=en(n)||"auto";d===void 0&&(d=1),m==="auto"&&(m=d<1?"rgba":"rgb"),f=Ue(f),o=Ue(o),g=Ue(g);var b=f<<16|o<<8|g,_="000000"+b.toString(16);_=_.substr(_.length-6);var R="0"+Ue(d*255).toString(16);switch(R=R.substr(R.length-2),m.toLowerCase()){case"rgba":return"#"+_+R;case"argb":return"#"+R+_;default:return"#"+_}},Ot=tn,rn=v.type;x.prototype.hex=function(n){return Ot(this._rgb,n)},F.hex=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["hex"])))},y.format.hex=ze,y.autodetect.push({p:4,test:function(n){for(var i=[],a=arguments.length-1;a-- >0;)i[a]=arguments[a+1];if(!i.length&&rn(n)==="string"&&[3,4,6,7,8,9].includes(n.length))return"hex"}});var nn=v.unpack,$t=v.TWOPI,sn=Math.min,an=Math.sqrt,hn=Math.acos,ln=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=nn(n,"rgb"),f=a[0],o=a[1],g=a[2];f/=255,o/=255,g/=255;var d,m=sn(f,o,g),b=(f+o+g)/3,_=b>0?1-m/b:0;return _===0?d=NaN:(d=(f-o+(f-g))/2,d/=an((f-o)*(f-o)+(f-g)*(o-g)),d=hn(d),g>o&&(d=$t-d),d/=$t),[d*360,_,b]},fn=ln,un=v.unpack,tt=v.limit,_e=v.TWOPI,rt=v.PITHIRD,Ae=Math.cos,cn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];n=un(n,"hsi");var a=n[0],f=n[1],o=n[2],g,d,m;return isNaN(a)&&(a=0),isNaN(f)&&(f=0),a>360&&(a-=360),a<0&&(a+=360),a/=360,a<1/3?(m=(1-f)/3,g=(1+f*Ae(_e*a)/Ae(rt-_e*a))/3,d=1-(m+g)):a<2/3?(a-=1/3,g=(1-f)/3,d=(1+f*Ae(_e*a)/Ae(rt-_e*a))/3,m=1-(g+d)):(a-=2/3,d=(1-f)/3,m=(1+f*Ae(_e*a)/Ae(rt-_e*a))/3,g=1-(d+m)),g=tt(o*g*3),d=tt(o*d*3),m=tt(o*m*3),[g*255,d*255,m*255,n.length>3?n[3]:1]},on=cn,dn=v.unpack,gn=v.type;x.prototype.hsi=function(){return fn(this._rgb)},F.hsi=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["hsi"])))},y.format.hsi=on,y.autodetect.push({p:2,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=dn(n,"hsi"),gn(n)==="array"&&n.length===3)return"hsi"}});var pn=v.unpack,vn=v.type;x.prototype.hsl=function(){return Ee(this._rgb)},F.hsl=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["hsl"])))},y.format.hsl=et,y.autodetect.push({p:2,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=pn(n,"hsl"),vn(n)==="array"&&n.length===3)return"hsl"}});var bn=v.unpack,mn=Math.min,yn=Math.max,wn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];n=bn(n,"rgb");var a=n[0],f=n[1],o=n[2],g=mn(a,f,o),d=yn(a,f,o),m=d-g,b,_,R;return R=d/255,d===0?(b=Number.NaN,_=0):(_=m/d,a===d&&(b=(f-o)/m),f===d&&(b=2+(o-a)/m),o===d&&(b=4+(a-f)/m),b*=60,b<0&&(b+=360)),[b,_,R]},xn=wn,En=v.unpack,Mn=Math.floor,_n=function(){for(var n,i,a,f,o,g,d=[],m=arguments.length;m--;)d[m]=arguments[m];d=En(d,"hsv");var b=d[0],_=d[1],R=d[2],A,z,C;if(R*=255,_===0)A=z=C=R;else{b===360&&(b=0),b>360&&(b-=360),b<0&&(b+=360),b/=60;var $=Mn(b),q=b-$,V=R*(1-_),Z=R*(1-_*q),ne=R*(1-_*(1-q));switch($){case 0:n=[R,ne,V],A=n[0],z=n[1],C=n[2];break;case 1:i=[Z,R,V],A=i[0],z=i[1],C=i[2];break;case 2:a=[V,R,ne],A=a[0],z=a[1],C=a[2];break;case 3:f=[V,Z,R],A=f[0],z=f[1],C=f[2];break;case 4:o=[ne,V,R],A=o[0],z=o[1],C=o[2];break;case 5:g=[R,V,Z],A=g[0],z=g[1],C=g[2];break}}return[A,z,C,d.length>3?d[3]:1]},An=_n,Fn=v.unpack,Tn=v.type;x.prototype.hsv=function(){return xn(this._rgb)},F.hsv=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["hsv"])))},y.format.hsv=An,y.autodetect.push({p:2,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=Fn(n,"hsv"),Tn(n)==="array"&&n.length===3)return"hsv"}});var he={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Rn=v.unpack,Bt=Math.pow,kn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Rn(n,"rgb"),f=a[0],o=a[1],g=a[2],d=Sn(f,o,g),m=d[0],b=d[1],_=d[2],R=116*b-16;return[R<0?0:R,500*(m-b),200*(b-_)]},nt=function(n){return(n/=255)<=.04045?n/12.92:Bt((n+.055)/1.055,2.4)},it=function(n){return n>he.t3?Bt(n,1/3):n/he.t2+he.t0},Sn=function(n,i,a){n=nt(n),i=nt(i),a=nt(a);var f=it((.4124564*n+.3575761*i+.1804375*a)/he.Xn),o=it((.2126729*n+.7151522*i+.072175*a)/he.Yn),g=it((.0193339*n+.119192*i+.9503041*a)/he.Zn);return[f,o,g]},Ut=kn,Nn=v.unpack,Pn=Math.pow,zn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];n=Nn(n,"lab");var a=n[0],f=n[1],o=n[2],g,d,m,b,_,R;return d=(a+16)/116,g=isNaN(f)?d:d+f/500,m=isNaN(o)?d:d-o/200,d=he.Yn*at(d),g=he.Xn*at(g),m=he.Zn*at(m),b=st(3.2404542*g-1.5371385*d-.4985314*m),_=st(-.969266*g+1.8760108*d+.041556*m),R=st(.0556434*g-.2040259*d+1.0572252*m),[b,_,R,n.length>3?n[3]:1]},st=function(n){return 255*(n<=.00304?12.92*n:1.055*Pn(n,1/2.4)-.055)},at=function(n){return n>he.t1?n*n*n:he.t2*(n-he.t0)},Gt=zn,Cn=v.unpack,Dn=v.type;x.prototype.lab=function(){return Ut(this._rgb)},F.lab=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["lab"])))},y.format.lab=Gt,y.autodetect.push({p:2,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=Cn(n,"lab"),Dn(n)==="array"&&n.length===3)return"lab"}});var Ln=v.unpack,In=v.RAD2DEG,On=Math.sqrt,$n=Math.atan2,Bn=Math.round,Un=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Ln(n,"lab"),f=a[0],o=a[1],g=a[2],d=On(o*o+g*g),m=($n(g,o)*In+360)%360;return Bn(d*1e4)===0&&(m=Number.NaN),[f,d,m]},Gn=Un,qn=v.unpack,Xn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=qn(n,"rgb"),f=a[0],o=a[1],g=a[2],d=Ut(f,o,g),m=d[0],b=d[1],_=d[2];return Gn(m,b,_)},qt=Xn,Vn=v.unpack,Yn=v.DEG2RAD,Wn=Math.sin,Hn=Math.cos,jn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Vn(n,"lch"),f=a[0],o=a[1],g=a[2];return isNaN(g)&&(g=0),g=g*Yn,[f,Hn(g)*o,Wn(g)*o]},Zn=jn,Qn=v.unpack,Kn=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];n=Qn(n,"lch");var a=n[0],f=n[1],o=n[2],g=Zn(a,f,o),d=g[0],m=g[1],b=g[2],_=Gt(d,m,b),R=_[0],A=_[1],z=_[2];return[R,A,z,n.length>3?n[3]:1]},Xt=Kn,Jn=v.unpack,ei=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Jn(n,"hcl").reverse();return Xt.apply(void 0,a)},ti=ei,ri=v.unpack,ni=v.type;x.prototype.lch=function(){return qt(this._rgb)},x.prototype.hcl=function(){return qt(this._rgb).reverse()},F.lch=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["lch"])))},F.hcl=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["hcl"])))},y.format.lch=Xt,y.format.hcl=ti,["lch","hcl"].forEach(function(n){return y.autodetect.push({p:2,test:function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(i=ri(i,n),ni(i)==="array"&&i.length===3)return n}})});var ii=v.type;x.prototype.name=function(){for(var n=Ot(this._rgb,"rgb"),i=0,a=Object.keys(pe);i<a.length;i+=1){var f=a[i];if(pe[f]===n)return f.toLowerCase()}return n},y.format.named=function(n){if(n=n.toLowerCase(),pe[n])return ze(pe[n]);throw new Error("unknown color name: "+n)},y.autodetect.push({p:5,test:function(n){for(var i=[],a=arguments.length-1;a-- >0;)i[a]=arguments[a+1];if(!i.length&&ii(n)==="string"&&pe[n.toLowerCase()])return"named"}});var si=v.unpack,ai=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=si(n,"rgb"),f=a[0],o=a[1],g=a[2];return(f<<16)+(o<<8)+g},hi=ai,li=v.type,fi=function(n){if(li(n)=="number"&&n>=0&&n<=16777215){var i=n>>16,a=n>>8&255,f=n&255;return[i,a,f,1]}throw new Error("unknown num color: "+n)},ui=fi,ci=v.type;x.prototype.num=function(){return hi(this._rgb)},F.num=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["num"])))},y.format.num=ui,y.autodetect.push({p:5,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n.length===1&&ci(n[0])==="number"&&n[0]>=0&&n[0]<=16777215)return"num"}});var Vt=v.unpack,Yt=v.type,Wt=Math.round;x.prototype.rgb=function(n){return n===void 0&&(n=!0),n===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Wt)},x.prototype.rgba=function(n){return n===void 0&&(n=!0),this._rgb.slice(0,4).map(function(i,a){return a<3?n===!1?i:Wt(i):i})},F.rgb=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["rgb"])))},y.format.rgb=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=Vt(n,"rgba");return a[3]===void 0&&(a[3]=1),a},y.autodetect.push({p:3,test:function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];if(n=Vt(n,"rgba"),Yt(n)==="array"&&(n.length===3||n.length===4&&Yt(n[3])=="number"&&n[3]>=0&&n[3]<=1))return"rgb"}});var Ge=Math.log,oi=function(n){var i=n/100,a,f,o;return i<66?(a=255,f=-155.25485562709179-.44596950469579133*(f=i-2)+104.49216199393888*Ge(f),o=i<20?0:-254.76935184120902+.8274096064007395*(o=i-10)+115.67994401066147*Ge(o)):(a=351.97690566805693+.114206453784165*(a=i-55)-40.25366309332127*Ge(a),f=325.4494125711974+.07943456536662342*(f=i-50)-28.0852963507957*Ge(f),o=255),[a,f,o,1]},Ht=oi,di=v.unpack,gi=Math.round,pi=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];for(var a=di(n,"rgb"),f=a[0],o=a[2],g=1e3,d=4e4,m=.4,b;d-g>m;){b=(d+g)*.5;var _=Ht(b);_[2]/_[0]>=o/f?d=b:g=b}return gi(b)},vi=pi;x.prototype.temp=x.prototype.kelvin=x.prototype.temperature=function(){return vi(this._rgb)},F.temp=F.kelvin=F.temperature=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];return new(Function.prototype.bind.apply(x,[null].concat(n,["temp"])))},y.format.temp=y.format.kelvin=y.format.temperature=Ht;var bi=v.type;x.prototype.alpha=function(n,i){return i===void 0&&(i=!1),n!==void 0&&bi(n)==="number"?i?(this._rgb[3]=n,this):new x([this._rgb[0],this._rgb[1],this._rgb[2],n],"rgb"):this._rgb[3]},x.prototype.clipped=function(){return this._rgb._clipped||!1},x.prototype.darken=function(n){n===void 0&&(n=1);var i=this,a=i.lab();return a[0]-=he.Kn*n,new x(a,"lab").alpha(i.alpha(),!0)},x.prototype.brighten=function(n){return n===void 0&&(n=1),this.darken(-n)},x.prototype.darker=x.prototype.darken,x.prototype.brighter=x.prototype.brighten,x.prototype.get=function(n){var i=n.split("."),a=i[0],f=i[1],o=this[a]();if(f){var g=a.indexOf(f);if(g>-1)return o[g];throw new Error("unknown channel "+f+" in mode "+a)}else return o};var mi=v.type,yi=Math.pow,wi=1e-7,xi=20;x.prototype.luminance=function(n){if(n!==void 0&&mi(n)==="number"){if(n===0)return new x([0,0,0,this._rgb[3]],"rgb");if(n===1)return new x([255,255,255,this._rgb[3]],"rgb");var i=this.luminance(),a="rgb",f=xi,o=function(d,m){var b=d.interpolate(m,.5,a),_=b.luminance();return Math.abs(n-_)<wi||!f--?b:_>n?o(d,b):o(b,m)},g=(i>n?o(new x([0,0,0]),this):o(this,new x([255,255,255]))).rgb();return new x(g.concat([this._rgb[3]]))}return Ei.apply(void 0,this._rgb.slice(0,3))};var Ei=function(n,i,a){return n=ht(n),i=ht(i),a=ht(a),.2126*n+.7152*i+.0722*a},ht=function(n){return n/=255,n<=.03928?n/12.92:yi((n+.055)/1.055,2.4)},le={},jt=v.type,Zt=function(n,i,a){a===void 0&&(a=.5);for(var f=[],o=arguments.length-3;o-- >0;)f[o]=arguments[o+3];var g=f[0]||"lrgb";if(!le[g]&&!f.length&&(g=Object.keys(le)[0]),!le[g])throw new Error("interpolation mode "+g+" is not defined");return jt(n)!=="object"&&(n=new x(n)),jt(i)!=="object"&&(i=new x(i)),le[g](n,i,a).alpha(n.alpha()+a*(i.alpha()-n.alpha()))};x.prototype.mix=x.prototype.interpolate=function(n,i){i===void 0&&(i=.5);for(var a=[],f=arguments.length-2;f-- >0;)a[f]=arguments[f+2];return Zt.apply(void 0,[this,n,i].concat(a))},x.prototype.premultiply=function(n){n===void 0&&(n=!1);var i=this._rgb,a=i[3];return n?(this._rgb=[i[0]*a,i[1]*a,i[2]*a,a],this):new x([i[0]*a,i[1]*a,i[2]*a,a],"rgb")},x.prototype.saturate=function(n){n===void 0&&(n=1);var i=this,a=i.lch();return a[1]+=he.Kn*n,a[1]<0&&(a[1]=0),new x(a,"lch").alpha(i.alpha(),!0)},x.prototype.desaturate=function(n){return n===void 0&&(n=1),this.saturate(-n)};var Qt=v.type;x.prototype.set=function(n,i,a){a===void 0&&(a=!1);var f=n.split("."),o=f[0],g=f[1],d=this[o]();if(g){var m=o.indexOf(g);if(m>-1){if(Qt(i)=="string")switch(i.charAt(0)){case"+":d[m]+=+i;break;case"-":d[m]+=+i;break;case"*":d[m]*=+i.substr(1);break;case"/":d[m]/=+i.substr(1);break;default:d[m]=+i}else if(Qt(i)==="number")d[m]=i;else throw new Error("unsupported value for Color.set");var b=new x(d,o);return a?(this._rgb=b._rgb,this):b}throw new Error("unknown channel "+g+" in mode "+o)}else return d};var Mi=function(n,i,a){var f=n._rgb,o=i._rgb;return new x(f[0]+a*(o[0]-f[0]),f[1]+a*(o[1]-f[1]),f[2]+a*(o[2]-f[2]),"rgb")};le.rgb=Mi;var lt=Math.sqrt,Fe=Math.pow,_i=function(n,i,a){var f=n._rgb,o=f[0],g=f[1],d=f[2],m=i._rgb,b=m[0],_=m[1],R=m[2];return new x(lt(Fe(o,2)*(1-a)+Fe(b,2)*a),lt(Fe(g,2)*(1-a)+Fe(_,2)*a),lt(Fe(d,2)*(1-a)+Fe(R,2)*a),"rgb")};le.lrgb=_i;var Ai=function(n,i,a){var f=n.lab(),o=i.lab();return new x(f[0]+a*(o[0]-f[0]),f[1]+a*(o[1]-f[1]),f[2]+a*(o[2]-f[2]),"lab")};le.lab=Ai;var Ce=function(n,i,a,f){var o,g,d,m;f==="hsl"?(d=n.hsl(),m=i.hsl()):f==="hsv"?(d=n.hsv(),m=i.hsv()):f==="hcg"?(d=n.hcg(),m=i.hcg()):f==="hsi"?(d=n.hsi(),m=i.hsi()):(f==="lch"||f==="hcl")&&(f="hcl",d=n.hcl(),m=i.hcl());var b,_,R,A,z,C;f.substr(0,1)==="h"&&(o=d,b=o[0],R=o[1],z=o[2],g=m,_=g[0],A=g[1],C=g[2]);var $,q,V,Z;return!isNaN(b)&&!isNaN(_)?(_>b&&_-b>180?Z=_-(b+360):_<b&&b-_>180?Z=_+360-b:Z=_-b,q=b+a*Z):isNaN(b)?isNaN(_)?q=Number.NaN:(q=_,(z==1||z==0)&&f!="hsv"&&($=A)):(q=b,(C==1||C==0)&&f!="hsv"&&($=R)),$===void 0&&($=R+a*(A-R)),V=z+a*(C-z),new x([q,$,V],f)},Kt=function(n,i,a){return Ce(n,i,a,"lch")};le.lch=Kt,le.hcl=Kt;var Fi=function(n,i,a){var f=n.num(),o=i.num();return new x(f+a*(o-f),"num")};le.num=Fi;var Ti=function(n,i,a){return Ce(n,i,a,"hcg")};le.hcg=Ti;var Ri=function(n,i,a){return Ce(n,i,a,"hsi")};le.hsi=Ri;var ki=function(n,i,a){return Ce(n,i,a,"hsl")};le.hsl=ki;var Si=function(n,i,a){return Ce(n,i,a,"hsv")};le.hsv=Si;var Ni=v.clip_rgb,ft=Math.pow,ut=Math.sqrt,ct=Math.PI,Jt=Math.cos,er=Math.sin,Pi=Math.atan2,zi=function(n,i){i===void 0&&(i="lrgb");var a=n.length;if(n=n.map(function(C){return new x(C)}),i==="lrgb")return Ci(n);for(var f=n.shift(),o=f.get(i),g=[],d=0,m=0,b=0;b<o.length;b++)if(o[b]=o[b]||0,g.push(isNaN(o[b])?0:1),i.charAt(b)==="h"&&!isNaN(o[b])){var _=o[b]/180*ct;d+=Jt(_),m+=er(_)}var R=f.alpha();n.forEach(function(C){var $=C.get(i);R+=C.alpha();for(var q=0;q<o.length;q++)if(!isNaN($[q]))if(g[q]++,i.charAt(q)==="h"){var V=$[q]/180*ct;d+=Jt(V),m+=er(V)}else o[q]+=$[q]});for(var A=0;A<o.length;A++)if(i.charAt(A)==="h"){for(var z=Pi(m/g[A],d/g[A])/ct*180;z<0;)z+=360;for(;z>=360;)z-=360;o[A]=z}else o[A]=o[A]/g[A];return R/=a,new x(o,i).alpha(R>.99999?1:R,!0)},Ci=function(n){for(var i=n.length,a=1/i,f=[0,0,0,0],o=0,g=n;o<g.length;o+=1){var d=g[o],m=d._rgb;f[0]+=ft(m[0],2)*a,f[1]+=ft(m[1],2)*a,f[2]+=ft(m[2],2)*a,f[3]+=m[3]*a}return f[0]=ut(f[0]),f[1]=ut(f[1]),f[2]=ut(f[2]),f[3]>.9999999&&(f[3]=1),new x(Ni(f))},Te=v.type,Di=Math.pow,qe=function(n){var i="rgb",a=F("#ccc"),f=0,o=[0,1],g=[],d=[0,0],m=!1,b=[],_=!1,R=0,A=1,z=!1,C={},$=!0,q=1,V=function(k){if(k=k||["#fff","#000"],k&&Te(k)==="string"&&F.brewer&&F.brewer[k.toLowerCase()]&&(k=F.brewer[k.toLowerCase()]),Te(k)==="array"){k.length===1&&(k=[k[0],k[0]]),k=k.slice(0);for(var I=0;I<k.length;I++)k[I]=F(k[I]);g.length=0;for(var G=0;G<k.length;G++)g.push(G/(k.length-1))}return ae(),b=k},Z=function(k){if(m!=null){for(var I=m.length-1,G=0;G<I&&k>=m[G];)G++;return G-1}return 0},ne=function(k){return k},ie=function(k,I){var G,Y;if(I==null&&(I=!1),isNaN(k)||k===null)return a;if(I)Y=k;else if(m&&m.length>2){var fe=Z(k);Y=fe/(m.length-2)}else A!==R?Y=(k-R)/(A-R):Y=1;I||(Y=ne(Y)),q!==1&&(Y=Di(Y,q)),Y=d[0]+Y*(1-d[0]-d[1]),Y=Math.min(1,Math.max(0,Y));var ee=Math.floor(Y*1e4);if($&&C[ee])G=C[ee];else{if(Te(b)==="array")for(var Q=0;Q<g.length;Q++){var se=g[Q];if(Y<=se){G=b[Q];break}if(Y>=se&&Q===g.length-1){G=b[Q];break}if(Y>se&&Y<g[Q+1]){Y=(Y-se)/(g[Q+1]-se),G=F.interpolate(b[Q],b[Q+1],Y,i);break}}else Te(b)==="function"&&(G=b(Y));$&&(C[ee]=G)}return G},ae=function(){return C={}};V(n);var X=function(k){var I=F(ie(k));return _&&I[_]?I[_]():I};return X.classes=function(k){if(k!=null){if(Te(k)==="array")m=k,o=[k[0],k[k.length-1]];else{var I=F.analyze(o);k===0?m=[I.min,I.max]:m=F.limits(I,"e",k)}return X}return m},X.domain=function(k){if(!arguments.length)return o;R=k[0],A=k[k.length-1],g=[];var I=b.length;if(k.length===I&&R!==A)for(var G=0,Y=Array.from(k);G<Y.length;G+=1){var fe=Y[G];g.push((fe-R)/(A-R))}else for(var ee=0;ee<I;ee++)g.push(ee/(I-1));return o=[R,A],X},X.mode=function(k){return arguments.length?(i=k,ae(),X):i},X.range=function(k,I){return V(k),X},X.out=function(k){return _=k,X},X.spread=function(k){return arguments.length?(f=k,X):f},X.correctLightness=function(k){return k==null&&(k=!0),z=k,ae(),z?ne=function(I){for(var G=ie(0,!0).lab()[0],Y=ie(1,!0).lab()[0],fe=G>Y,ee=ie(I,!0).lab()[0],Q=G+(Y-G)*I,se=ee-Q,ue=0,ce=1,we=20;Math.abs(se)>.01&&we-- >0;)(function(){return fe&&(se*=-1),se<0?(ue=I,I+=(ce-I)*.5):(ce=I,I+=(ue-I)*.5),ee=ie(I,!0).lab()[0],se=ee-Q})();return I}:ne=function(I){return I},X},X.padding=function(k){return k!=null?(Te(k)==="number"&&(k=[k,k]),d=k,X):d},X.colors=function(k,I){arguments.length<2&&(I="hex");var G=[];if(arguments.length===0)G=b.slice(0);else if(k===1)G=[X(.5)];else if(k>1){var Y=o[0],fe=o[1]-Y;G=Li(0,k).map(function(ce){return X(Y+ce/(k-1)*fe)})}else{n=[];var ee=[];if(m&&m.length>2)for(var Q=1,se=m.length,ue=1<=se;ue?Q<se:Q>se;ue?Q++:Q--)ee.push((m[Q-1]+m[Q])*.5);else ee=o;G=ee.map(function(ce){return X(ce)})}return F[I]&&(G=G.map(function(ce){return ce[I]()})),G},X.cache=function(k){return k!=null?($=k,X):$},X.gamma=function(k){return k!=null?(q=k,X):q},X.nodata=function(k){return k!=null?(a=F(k),X):a},X};function Li(n,i,a){for(var f=[],o=n<i,g=i,d=n;o?d<g:d>g;o?d++:d--)f.push(d);return f}var ot=function(n){var i,a,f,o,g,d,m;if(n=n.map(function(A){return new x(A)}),n.length===2)i=n.map(function(A){return A.lab()}),g=i[0],d=i[1],o=function(A){var z=[0,1,2].map(function(C){return g[C]+A*(d[C]-g[C])});return new x(z,"lab")};else if(n.length===3)a=n.map(function(A){return A.lab()}),g=a[0],d=a[1],m=a[2],o=function(A){var z=[0,1,2].map(function(C){return(1-A)*(1-A)*g[C]+2*(1-A)*A*d[C]+A*A*m[C]});return new x(z,"lab")};else if(n.length===4){var b;f=n.map(function(A){return A.lab()}),g=f[0],d=f[1],m=f[2],b=f[3],o=function(A){var z=[0,1,2].map(function(C){return(1-A)*(1-A)*(1-A)*g[C]+3*(1-A)*(1-A)*A*d[C]+3*(1-A)*A*A*m[C]+A*A*A*b[C]});return new x(z,"lab")}}else if(n.length===5){var _=ot(n.slice(0,3)),R=ot(n.slice(2,5));o=function(A){return A<.5?_(A*2):R((A-.5)*2)}}return o},Ii=function(n){var i=ot(n);return i.scale=function(){return qe(i)},i},oe=function(n,i,a){if(!oe[a])throw new Error("unknown blend mode "+a);return oe[a](n,i)},ve=function(n){return function(i,a){var f=F(a).rgb(),o=F(i).rgb();return F.rgb(n(f,o))}},be=function(n){return function(i,a){var f=[];return f[0]=n(i[0],a[0]),f[1]=n(i[1],a[1]),f[2]=n(i[2],a[2]),f}},Oi=function(n){return n},$i=function(n,i){return n*i/255},Bi=function(n,i){return n>i?i:n},Ui=function(n,i){return n>i?n:i},Gi=function(n,i){return 255*(1-(1-n/255)*(1-i/255))},qi=function(n,i){return i<128?2*n*i/255:255*(1-2*(1-n/255)*(1-i/255))},Xi=function(n,i){return 255*(1-(1-i/255)/(n/255))},Vi=function(n,i){return n===255?255:(n=255*(i/255)/(1-n/255),n>255?255:n)};oe.normal=ve(be(Oi)),oe.multiply=ve(be($i)),oe.screen=ve(be(Gi)),oe.overlay=ve(be(qi)),oe.darken=ve(be(Bi)),oe.lighten=ve(be(Ui)),oe.dodge=ve(be(Vi)),oe.burn=ve(be(Xi));for(var Yi=oe,dt=v.type,Wi=v.clip_rgb,Hi=v.TWOPI,ji=Math.pow,Zi=Math.sin,Qi=Math.cos,Ki=function(n,i,a,f,o){n===void 0&&(n=300),i===void 0&&(i=-1.5),a===void 0&&(a=1),f===void 0&&(f=1),o===void 0&&(o=[0,1]);var g=0,d;dt(o)==="array"?d=o[1]-o[0]:(d=0,o=[o,o]);var m=function(b){var _=Hi*((n+120)/360+i*b),R=ji(o[0]+d*b,f),A=g!==0?a[0]+b*g:a,z=A*R*(1-R)/2,C=Qi(_),$=Zi(_),q=R+z*(-.14861*C+1.78277*$),V=R+z*(-.29227*C-.90649*$),Z=R+z*(1.97294*C);return F(Wi([q*255,V*255,Z*255,1]))};return m.start=function(b){return b==null?n:(n=b,m)},m.rotations=function(b){return b==null?i:(i=b,m)},m.gamma=function(b){return b==null?f:(f=b,m)},m.hue=function(b){return b==null?a:(a=b,dt(a)==="array"?(g=a[1]-a[0],g===0&&(a=a[1])):g=0,m)},m.lightness=function(b){return b==null?o:(dt(b)==="array"?(o=b,d=b[1]-b[0]):(o=[b,b],d=0),m)},m.scale=function(){return F.scale(m)},m.hue(a),m},Ji="0123456789abcdef",es=Math.floor,ts=Math.random,rs=function(){for(var n="#",i=0;i<6;i++)n+=Ji.charAt(es(ts()*16));return new x(n,"hex")},tr=Math.log,ns=Math.pow,is=Math.floor,ss=Math.abs,rr=function(n,i){i===void 0&&(i=null);var a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return p(n)==="object"&&(n=Object.values(n)),n.forEach(function(f){i&&p(f)==="object"&&(f=f[i]),f!=null&&!isNaN(f)&&(a.values.push(f),a.sum+=f,f<a.min&&(a.min=f),f>a.max&&(a.max=f),a.count+=1)}),a.domain=[a.min,a.max],a.limits=function(f,o){return nr(a,f,o)},a},nr=function(n,i,a){i===void 0&&(i="equal"),a===void 0&&(a=7),p(n)=="array"&&(n=rr(n));var f=n.min,o=n.max,g=n.values.sort(function(yt,wt){return yt-wt});if(a===1)return[f,o];var d=[];if(i.substr(0,1)==="c"&&(d.push(f),d.push(o)),i.substr(0,1)==="e"){d.push(f);for(var m=1;m<a;m++)d.push(f+m/a*(o-f));d.push(o)}else if(i.substr(0,1)==="l"){if(f<=0)throw new Error("Logarithmic scales are only possible for values > 0");var b=Math.LOG10E*tr(f),_=Math.LOG10E*tr(o);d.push(f);for(var R=1;R<a;R++)d.push(ns(10,b+R/a*(_-b)));d.push(o)}else if(i.substr(0,1)==="q"){d.push(f);for(var A=1;A<a;A++){var z=(g.length-1)*A/a,C=is(z);if(C===z)d.push(g[C]);else{var $=z-C;d.push(g[C]*(1-$)+g[C+1]*$)}}d.push(o)}else if(i.substr(0,1)==="k"){var q,V=g.length,Z=new Array(V),ne=new Array(a),ie=!0,ae=0,X=null;X=[],X.push(f);for(var k=1;k<a;k++)X.push(f+k/a*(o-f));for(X.push(o);ie;){for(var I=0;I<a;I++)ne[I]=0;for(var G=0;G<V;G++)for(var Y=g[G],fe=Number.MAX_VALUE,ee=void 0,Q=0;Q<a;Q++){var se=ss(X[Q]-Y);se<fe&&(fe=se,ee=Q),ne[ee]++,Z[G]=ee}for(var ue=new Array(a),ce=0;ce<a;ce++)ue[ce]=null;for(var we=0;we<V;we++)q=Z[we],ue[q]===null?ue[q]=g[we]:ue[q]+=g[we];for(var Ye=0;Ye<a;Ye++)ue[Ye]*=1/ne[Ye];ie=!1;for(var We=0;We<a;We++)if(ue[We]!==X[We]){ie=!0;break}X=ue,ae++,ae>200&&(ie=!1)}for(var De={},vt=0;vt<a;vt++)De[vt]=[];for(var He=0;He<V;He++)q=Z[He],De[q].push(g[He]);for(var xe=[],Le=0;Le<a;Le++)xe.push(De[Le][0]),xe.push(De[Le][De[Le].length-1]);xe=xe.sort(function(yt,wt){return yt-wt}),d.push(xe[0]);for(var bt=1;bt<xe.length;bt+=2){var mt=xe[bt];!isNaN(mt)&&d.indexOf(mt)===-1&&d.push(mt)}}return d},ir={analyze:rr,limits:nr},as=function(n,i){n=new x(n),i=new x(i);var a=n.luminance(),f=i.luminance();return a>f?(a+.05)/(f+.05):(f+.05)/(a+.05)},Xe=Math.sqrt,hs=Math.atan2,sr=Math.abs,ar=Math.cos,gt=Math.PI,ls=function(n,i,a,f){a===void 0&&(a=1),f===void 0&&(f=1),n=new x(n),i=new x(i);for(var o=Array.from(n.lab()),g=o[0],d=o[1],m=o[2],b=Array.from(i.lab()),_=b[0],R=b[1],A=b[2],z=Xe(d*d+m*m),C=Xe(R*R+A*A),$=g<16?.511:.040975*g/(1+.01765*g),q=.0638*z/(1+.0131*z)+.638,V=z<1e-6?0:hs(m,d)*180/gt;V<0;)V+=360;for(;V>=360;)V-=360;var Z=V>=164&&V<=345?.56+sr(.2*ar(gt*(V+168)/180)):.36+sr(.4*ar(gt*(V+35)/180)),ne=z*z*z*z,ie=Xe(ne/(ne+1900)),ae=q*(ie*Z+1-ie),X=g-_,k=z-C,I=d-R,G=m-A,Y=I*I+G*G-k*k,fe=X/(a*$),ee=k/(f*q),Q=ae;return Xe(fe*fe+ee*ee+Y/(Q*Q))},fs=function(n,i,a){a===void 0&&(a="lab"),n=new x(n),i=new x(i);var f=n.get(a),o=i.get(a),g=0;for(var d in f){var m=(f[d]||0)-(o[d]||0);g+=m*m}return Math.sqrt(g)},us=function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];try{return new(Function.prototype.bind.apply(x,[null].concat(n))),!0}catch{return!1}},cs={cool:function(){return qe([F.hsl(180,1,.9),F.hsl(250,.7,.4)])},hot:function(){return qe(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Ve={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},pt=0,hr=Object.keys(Ve);pt<hr.length;pt+=1){var lr=hr[pt];Ve[lr.toLowerCase()]=Ve[lr]}var os=Ve;F.average=zi,F.bezier=Ii,F.blend=Yi,F.cubehelix=Ki,F.mix=F.interpolate=Zt,F.random=rs,F.scale=qe,F.analyze=ir.analyze,F.contrast=as,F.deltaE=ls,F.distance=fs,F.limits=ir.limits,F.valid=us,F.scales=cs,F.colors=pe,F.brewer=os;var ds=F;return ds})}(je)),je.exports}var rh=th();const Cr=Ja(rh);function nh(){let t,e,r,s,h,l,u,c=!1,p,w,E,M,v;const y=new kr([.149,.141,.912]),T=new kr([1,.833,.224]);let P=50;S();function S(){t=new zs({dpr:1}),e=t.gl,document.body.appendChild(e.canvas),r=new xa(e,{fov:45}),r.position.set(0,0,P),J(),window.addEventListener("resize",J,!1),u=new Ie,N(),U(),requestAnimationFrame(D)}function N(){e.clearColor(1,1,1,1),M=new ih(t),x()}function x(){p=s,w=h;const L=3,H=L*l/s,W=Math.floor(p/L)+1,j=Math.floor(w/L)+1,B=W*j,de=-H*(W/2-.5),Re=-H*(j/2-.5),Oe=new Float32Array(B*3),$e=new Float32Array(B*2),Be=new Float32Array(B);let ke,Ee,Se,Ne;E=p/w,E>=1?(ke=0,Se=1/W,Ee=(1-1/E)/2,Ne=1/j/E):(ke=(1-1*E)/2,Se=1/W*E,Ee=0,Ne=1/j);for(let ge=0;ge<W;ge++){const Ze=de+ge*H;for(let ye=0;ye<j;ye++){const Pe=ge*j+ye,Qe=Pe*2,ze=Pe*3,Ke=Re+ye*H;Oe.set([Ze,Ke,0],ze),$e.set([ke+ge*Se,Ee+ye*Ne],Qe),Be[Pe]=L/2}}const Me=new Lr(e,{position:{size:3,data:Oe},uv:{size:2,data:$e},size:{size:1,data:Be}});if(v)v.geometry=Me;else{const ge=new Rt(e,{uniforms:{hmap:{value:M.gpgpu.read.texture},color1:{value:y},color2:{value:T}},vertex:`
          precision highp float;
          const float PI = 3.1415926535897932384626433832795;
          uniform mat4 modelViewMatrix;
          uniform mat4 projectionMatrix;
          uniform sampler2D hmap;
          uniform vec3 color1;
          uniform vec3 color2;
          attribute vec2 uv;
          attribute vec3 position;
          attribute float size;
          varying vec4 vColor;
          void main() {
              vec3 pos = position.xyz;
              vec4 htex = texture2D(hmap, uv);
              pos.z = 10. * htex.r;

              vec3 mixPct = vec3(0.0);
              mixPct.r = smoothstep(0.0, 0.5, htex.r);
              mixPct.g = sin(htex.r * PI);
              mixPct.b = pow(htex.r, 0.5);
              vColor = vec4(mix(color1, color2, mixPct), 1.0);

              gl_PointSize = size;
              gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
          }
        `,fragment:`
          precision highp float;
          varying vec4 vColor;
          void main() {
            gl_FragColor = vColor;
          }
        `});v=new $r(e,{geometry:Me,program:ge,mode:e.POINTS})}}function D(L){if(requestAnimationFrame(D),r.position.z+=(P-r.position.z)*.02,!c){const H=Date.now()*.001,W=Math.cos(H)*.2,j=Math.sin(H)*.2;M.addDrop(W,j,.05,.05)}M.update(),t.render({scene:v,camera:r})}function F(){y.set(Cr.random().hex()),T.set(Cr.random().hex())}function U(){"ontouchstart"in window?(document.body.addEventListener("touchstart",K,!1),document.body.addEventListener("touchmove",K,!1),document.body.addEventListener("touchend",()=>{c=!1},!1)):(document.body.addEventListener("mousemove",K,!1),document.body.addEventListener("mouseleave",()=>{c=!1},!1),document.body.addEventListener("mouseup",F,!1),document.addEventListener("scroll",L=>{P=50-O()*3}))}function O(){const L=document.documentElement.scrollTop,H=document.documentElement.scrollHeight-document.documentElement.clientHeight;return L/H}function K(L){c=!0,L.changedTouches&&L.changedTouches.length&&(L.x=L.changedTouches[0].pageX,L.y=L.changedTouches[0].pageY),L.x===void 0&&(L.x=L.pageX,L.y=L.pageY),u.set(L.x/e.renderer.width*2-1,(1-L.y/e.renderer.height)*2-1),E>=1?u.y=u.y/E:u.x=u.x/E,M.addDrop(u.x,u.y,.05,.05)}function J(){s=window.innerWidth,h=window.innerHeight,t.setSize(s,h),r.perspective({aspect:s/h}),l=te(r)[0],v&&x()}function te(L){const H=L.fov*Math.PI/180,W=2*Math.tan(H/2)*Math.abs(L.position.z);return[W*L.aspect,W]}}const ih=function(){function t(e){this.renderer=e,this.gl=e.gl,this.width=512,this.height=512,this.delta=new Ie(1/this.width,1/this.height),this.gpgpu=new sh(this.renderer.gl,{width:this.width,height:this.height,type:void 0}),this.initShaders()}return t.prototype.initShaders=function(){const e=`
      attribute vec2 uv;
      attribute vec2 position;
      varying vec2 vUv;
      void main() {
          vUv = uv;
          gl_Position = vec4(position, 0, 1);
      }
    `;this.updateProgram=new Rt(this.gl,{uniforms:{tDiffuse:{value:null},uDelta:{value:this.delta}},vertex:e,fragment:`
        precision highp float;
        uniform sampler2D tDiffuse;
        uniform vec2 uDelta;
        varying vec2 vUv;
        void main() {
          vec4 texel = texture2D(tDiffuse, vUv);

          vec2 dx = vec2(uDelta.x, 0.0);
          vec2 dy = vec2(0.0, uDelta.y);
          float average = (
            texture2D(tDiffuse, vUv - dx).r +
            texture2D(tDiffuse, vUv - dy).r +
            texture2D(tDiffuse, vUv + dx).r +
            texture2D(tDiffuse, vUv + dy).r
          ) * 0.25;

          texel.g += (average - texel.r) * 2.0;
          texel.g *= 0.8;
          texel.r += texel.g;

          gl_FragColor = texel;
        }
      `}),this.dropProgram=new Rt(this.gl,{uniforms:{tDiffuse:{value:null},uCenter:{value:new Ie},uRadius:{value:.05},uStrength:{value:.05}},vertex:e,fragment:`
        precision highp float;
        const float PI = 3.1415926535897932384626433832795;
        uniform sampler2D tDiffuse;
        uniform vec2 uCenter;
        uniform float uRadius;
        uniform float uStrength;
        varying vec2 vUv;
        void main() {
          vec4 texel = texture2D(tDiffuse, vUv);
          float drop = max(0.0, 1.0 - length(uCenter * 0.5 + 0.5 - vUv) / uRadius);
          drop = 0.5 - cos(drop * PI) * 0.5;
          texel.r += drop * uStrength;
          // texel.r = clamp(texel.r, -2.0, 2.0);
          gl_FragColor = texel;
        }
      `})},t.prototype.update=function(){this.updateProgram.uniforms.tDiffuse.value=this.gpgpu.read.texture,this.gpgpu.renderProgram(this.updateProgram)},t.prototype.addDrop=function(e,r,s,h){const l=this.dropProgram.uniforms;l.tDiffuse.value=this.gpgpu.read.texture,l.uCenter.value.set(e,r),l.uRadius.value=s,l.uStrength.value=h,this.gpgpu.renderProgram(this.dropProgram)},t}(),sh=function(){function t(e,{width:r,height:s,type:h}){this.gl=e,this.width=r,this.height=s,this.numVertexes=this.width*this.height;const l={width:this.width,height:this.height,type:h||e.HALF_FLOAT||e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,internalFormat:e.renderer.isWebgl2?h===e.FLOAT?e.RGBA32F:e.RGBA16F:e.RGBA,depth:!1,unpackAlignment:1};this.read=new Ar(e,l),this.write=new Ar(e,l),this.mesh=new $r(e,{geometry:new Ka(e)})}return t.prototype.renderProgram=function(e){this.mesh.program=e,this.gl.renderer.render({scene:this.mesh,target:this.write,clear:!1}),this.swap()},t.prototype.swap=function(){const e=this.read;this.read=this.write,this.write=e},t}();nh();
